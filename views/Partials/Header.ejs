<header id="page-topbar" class="isvertical-topbar">
  <div class="navbar-header">
    <div class="d-flex">
      <div class="navbar-brand-box"></div>

      <button type="button" class="btn btn-sm px-3 font-size-16 header-item vertical-menu-btn">
        <i class="fa fa-fw fa-bars"></i>
      </button>
    </div>

    <div class="d-flex">
      <div class="dropdown d-inline-block d-lg-none">
        <button
          type="button"
          class="btn header-item"
          data-bs-toggle="dropdown"
          aria-haspopup="true"
          aria-expanded="false"
        >
          <i class="icon-sm" data-feather="search"></i>
        </button>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0">
          <form class="p-2">
            <div class="search-box">
              <div class="position-relative">
                <input type="text" class="form-control rounded bg-light border-0" placeholder="Search..." />
                <i class="mdi mdi-magnify search-icon"></i>
              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="dropdown d-inline-block language-switch">
        <button
          type="button"
          class="btn header-item"
          data-bs-toggle="dropdown"
          aria-haspopup="true"
          aria-expanded="false"
        >
          <% if(lang=="en") { %>
          <img src="/assets/images/flags/us.jpg" alt="Header Language" height="16" />

          <% } else if(lang=="it") { %>
          <img src="/assets/images/flags/italy.jpg" alt="Header Language" height="16" />

          <% } else { %>
          <img src="/assets/images/flags/us.jpg" alt="Header Language" height="16" />
          <% } %>
        </button>
        <div class="dropdown-menu dropdown-menu-end">
          <a href="?clang=en" class="dropdown-item notify-item language" data-lang="eng">
            <img src="/assets/images/flags/us.jpg" alt="user-image" class="me-1" height="12" />
            <span class="align-middle">English</span>
          </a>

          <a href="?clang=it" class="dropdown-item notify-item language" data-lang="it">
            <img src="/assets/images/flags/italy.jpg" alt="user-image" class="me-1" height="12" />
            <span class="align-middle">Italian</span>
          </a>
        </div>
      </div>

      <div class="dropdown d-inline-block">
        <button
          type="button"
          class="btn header-item noti-icon"
          id="page-header-notifications-dropdown"
          data-bs-toggle="dropdown"
          aria-haspopup="true"
          aria-expanded="false"
        >
          <i class="icon-sm" data-feather="bell"></i>
          <span class="noti-dot bg-danger rounded-pill"> 
            <% if (typeof notifications !== 'undefined') { %> 
             <%= notifications.length %></span>
            <%}%>
        </button>
        <div
          class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0"
          aria-labelledby="page-header-notifications-dropdown"
        >
          <div class="p-3">
            <div class="row align-items-center">
              <div class="col">
                <h5 class="m-0 font-size-15"><%=translation.Notifications%></h5>
              </div>
            </div>
          </div>
          <div data-simplebar style="max-height: 250px">
            <h6 class="dropdown-header bg-light"></h6>
            <% if (typeof notifications !== 'undefined') { %> 
              <% notifications.forEach(function(notification) { %>
                <a href="#" class="text-reset notification-item">
                  <div class="d-flex border-bottom align-items-start">
                    <div class="flex-grow-1">
                      <h6 class="mb-1"><%= notification.name %></h6>
                      <h6 class="mb-1"><%= notification.from %></h6>
                      <div class="text-muted">
                        <p class="mb-1 font-size-13">
                          <li><%= notification.text.substring(0, 100) %></li>
                        </p>
                        <p class="mb-0 font-size-10 text-uppercase fw-bold">
                          <i class="mdi mdi-clock-outline"></i> <%= notification.createdAt %>
                        </p>
                      </div>
                    </div>
                  </div>
                </a>
              <% }); %> 
            <%}%>
          </div>
          <div class="p-2 border-top d-grid">
            <a class="btn btn-sm btn-link font-size-14 btn-block text-center" href="/messages">
              <i class="uil-arrow-circle-right me-1"></i>
              <span>View more</span>
            </a>
          </div>
        </div>
      </div>

      <div class="dropdown d-inline-block">
        <button
          type="button"
          class="btn header-item user text-start d-flex align-items-center"
          id="page-header-user-dropdown"
          data-bs-toggle="dropdown"
          aria-haspopup="true"
          aria-expanded="false"
        >
          <% if (typeof currentUser !== 'undefined') { %>
          <img
            class="rounded-circle header-profile-user"
            src="<%= process.env.NODE_URL %>/assets/images/users/<%= currentUser.photo %>"
            onerror="this.onerror=null;this.src='<%= process.env.NODE_URL %>/assets/images/users/default.jpg';"
          />
          <%} else {%>
          <img
            class="rounded-circle header-profile-user"
            src="<%= process.env.NODE_URL %>/assets/images/users/default.jpg"
          />
          <%}%>
        </button>
        <div class="dropdown-menu dropdown-menu-end pt-0">
          <div class="profileName">
            <% if (typeof currentUser !== 'undefined') { %> <%= currentUser.name %> <%= currentUser.surname %> <%}%>
          </div>
          <a class="dropdown-item" href="/profile"
            ><i class="bx bx-user-circle text-muted font-size-18 align-middle me-1"></i>
            <span class="align-middle"><%=translation.My_Account%></span></a
          >
          <a class="dropdown-item" href="/passwordMe"
            ><i class="bx bx-user-circle text-muted font-size-18 align-middle me-1"></i>
            <span class="align-middle"><%=translation.Change_Password%></span></a
          >
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="/logout"
            ><i class="bx bx-log-out text-muted font-size-18 align-middle me-1"></i>
            <span class="align-middle"><%=translation.Logout%></span></a
          >
        </div>
      </div>
    </div>
  </div>
</header>
